flux-event-handler
---

A small handler that accepts incoming Event payloads generated by
[fluxcloud](https://github.com/justinbarrick/fluxcloud).

The payload will be processed and the result will be sent to a Notifier.
Currently the stock notifiers are:

* [StdoutNotifier](src/Notifier/StdoutNotifier.php) - Send output to STDOUT (useful for testing/development)
* [SlackNotifier](src/Notifier/SlackNotifier.php) - Send output to a Slack Incoming Webhook endpoint

Additional Notifier implementations can be added at any time and should implement the
[Notifier](src/Notifier/Notifier.php) interface.

#### Development

For development purposes, a Docker Compose container has been added in this repository, which should work
out of the box if you have Docker Compose installed. Simply run this command from the project root:

```
docker-compose up
```

For production environments, you can use the supplied Dockerfile to build the image based on your
current codebase. Simply build and push the image to any desired registry:

```
docker build -t your-org/flux-event-handler:latest .
docker push your-org/flux-event-handler
```

#### Configuration (through environment variables)

The application can be configured by defining environment variables.
The following environment variables can be set:

| Name              | Description                         | Required?                | Default |
|-------------------|-------------------------------------|--------------------------|---------|
| DEBUG             | Control verbosity                   | No                       | False   |
| SLACK_WEBHOOK_URL | URL to your Slack incoming webhook  | If SlackNotifier is used | -       |
| SHORT_IMAGE_NAMES | Use short image names in output     | No                       | True    |
| SLACK_USERNAME    | Username to post to Slack with      | No                       | Flux    |
| SLACK_ICON        | User icon to post to Slack with     | No                       | :cloud: |
| NAMESPACE_MAPPING | Namespace notification [mapping][1] | No                       | -       |

[1]: src/Notifier/NamespaceMapper.php
